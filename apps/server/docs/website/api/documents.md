# æ–‡æ¡£ API

æ–‡æ¡£æ¨¡å—æä¾›æ–‡æ¡£çš„åˆ›å»ºã€ç¼–è¾‘ã€ç‰ˆæœ¬æ§åˆ¶ã€å‘å¸ƒç­‰åŠŸèƒ½ã€‚

## æ¥å£åˆ—è¡¨

| æ–¹æ³•   | è·¯å¾„                                 | è¯´æ˜               | è®¤è¯ |
| ------ | ------------------------------------ | ------------------ | ---- |
| POST   | `/documents`                         | åˆ›å»ºæ–‡æ¡£           | æ˜¯   |
| GET    | `/documents`                         | æ–‡æ¡£åˆ—è¡¨           | æ˜¯   |
| GET    | `/documents/search`                  | æœç´¢æ–‡æ¡£           | æ˜¯   |
| GET    | `/documents/:docId`                  | æ–‡æ¡£è¯¦æƒ…           | æ˜¯   |
| GET    | `/documents/:docId/content`          | æ–‡æ¡£å†…å®¹/æ¸²æŸ“æ ‘    | æ˜¯   |
| PATCH  | `/documents/:docId`                  | æ›´æ–°æ–‡æ¡£å…ƒæ•°æ®     | æ˜¯   |
| POST   | `/documents/:docId/publish`          | å‘å¸ƒæ–‡æ¡£           | æ˜¯   |
| POST   | `/documents/:docId/move`             | ç§»åŠ¨æ–‡æ¡£           | æ˜¯   |
| DELETE | `/documents/:docId`                  | åˆ é™¤æ–‡æ¡£           | æ˜¯   |
| GET    | `/documents/:docId/revisions`        | ä¿®è®¢å†å²           | æ˜¯   |
| GET    | `/documents/:docId/diff`             | ç‰ˆæœ¬å¯¹æ¯”           | æ˜¯   |
| POST   | `/documents/:docId/revert`           | å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬     | æ˜¯   |
| POST   | `/documents/:docId/snapshots`        | åˆ›å»ºå¿«ç…§           | æ˜¯   |
| POST   | `/documents/:docId/commit`           | æ‰‹åŠ¨è§¦å‘åˆ›å»ºç‰ˆæœ¬   | æ˜¯   |
| GET    | `/documents/:docId/pending-versions` | è·å–å¾…åˆ›å»ºç‰ˆæœ¬æ•°é‡ | æ˜¯   |

## åˆ›å»ºæ–‡æ¡£

**æ¥å£ï¼š** `POST /api/v1/documents`

**è¯´æ˜ï¼š** åˆ›å»ºæ–°æ–‡æ¡£ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºæ ¹å—å’Œåˆå§‹ç‰ˆæœ¬

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**

```json
{
  "workspaceId": "ws_1705123456789_abc123",
  "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡æ¡£",
  "icon": "ğŸ“„",
  "cover": "https://example.com/cover.jpg",
  "visibility": "workspace",
  "parentId": null,
  "tags": ["tag_1234567890_abc123", "tag_1234567890_def456"],
  "category": "æŠ€æœ¯æ–‡æ¡£"
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ          | ç±»å‹     | å¿…å¡« | è¯´æ˜                                                              |
| ------------- | -------- | ---- | ----------------------------------------------------------------- |
| `workspaceId` | string   | âœ…   | å·¥ä½œç©ºé—´ID                                                        |
| `title`       | string   | âœ…   | æ–‡æ¡£æ ‡é¢˜ï¼Œ1-255ä¸ªå­—ç¬¦                                             |
| `icon`        | string   | âŒ   | æ–‡æ¡£å›¾æ ‡ï¼ˆemojiï¼‰ï¼Œæœ€å¤š10ä¸ªå­—ç¬¦                                   |
| `cover`       | string   | âŒ   | æ–‡æ¡£å°é¢URLï¼Œæœ€å¤š500ä¸ªå­—ç¬¦                                        |
| `visibility`  | string   | âŒ   | å¯è§æ€§ï¼š`private`ï¼ˆé»˜è®¤ï¼‰ã€`workspace`ã€`public`                  |
| `parentId`    | string   | âŒ   | çˆ¶æ–‡æ¡£IDï¼ˆç”¨äºæ–‡æ¡£æ ‘ç»“æ„ï¼‰                                        |
| `tags`        | string[] | âŒ   | æ ‡ç­¾IDåˆ—è¡¨ï¼ˆtagIdæ•°ç»„ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¡éªŒæ ‡ç­¾æ˜¯å¦å­˜åœ¨å¹¶æ›´æ–°ä½¿ç”¨ç»Ÿè®¡ |
| `category`    | string   | âŒ   | åˆ†ç±»ï¼Œæœ€å¤š50ä¸ªå­—ç¬¦                                                |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "workspaceId": "ws_1705123456789_abc123",
    "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡æ¡£",
    "icon": "ğŸ“„",
    "rootBlockId": "b_1705123456789_root789",
    "head": 1,
    "publishedHead": 0,
    "status": "draft",
    "visibility": "workspace",
    "tags": ["tag_1234567890_abc123", "tag_1234567890_def456"],
    "category": "æŠ€æœ¯æ–‡æ¡£",
    "createdAt": "2024-01-15T10:30:00.000Z"
  }
}
```

**é‡è¦è¯´æ˜ï¼š**

- åˆ›å»ºæ–‡æ¡£æ—¶ä¼š**è‡ªåŠ¨åˆ›å»ºæ ¹å—**ï¼ˆ`rootBlockId`ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨åˆ›å»º
- åˆ›å»ºæ–‡æ¡£æ—¶ä¼š**è‡ªåŠ¨åˆ›å»ºåˆå§‹ç‰ˆæœ¬**ï¼ˆ`head = 1`ï¼‰
- å¦‚æœæŒ‡å®šäº† `parentId`ï¼Œçˆ¶æ–‡æ¡£å¿…é¡»å±äºåŒä¸€å·¥ä½œç©ºé—´
- **æ ‡ç­¾å­—æ®µ**ï¼š`tags` å­—æ®µåº”ä¼ å…¥**æ ‡ç­¾ID**ï¼ˆtagIdï¼‰æ•°ç»„ï¼Œä¸æ˜¯æ ‡ç­¾åç§°
  - ç³»ç»Ÿä¼šè‡ªåŠ¨æ ¡éªŒæ ‡ç­¾IDæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ä¼šè¿”å›é”™è¯¯
  - æ ‡ç­¾çš„ `usageCount` ä¼šè‡ªåŠ¨æ›´æ–°ï¼ˆ+1ï¼‰

**çŠ¶æ€ç ï¼š**

- `201 Created` - åˆ›å»ºæˆåŠŸ
- `400 Bad Request` - è¯·æ±‚å‚æ•°é”™è¯¯
- `403 Forbidden` - æ²¡æœ‰æƒé™è®¿é—®å·¥ä½œç©ºé—´

## è·å–æ–‡æ¡£åˆ—è¡¨

**æ¥å£ï¼š** `GET /api/v1/documents`

**è¯´æ˜ï¼š** è·å–æ–‡æ¡£åˆ—è¡¨ï¼Œæ”¯æŒå¤šç§è¿‡æ»¤æ¡ä»¶

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**æŸ¥è¯¢å‚æ•°ï¼š**

| å‚æ•°          | ç±»å‹     | å¿…å¡« | è¯´æ˜                                                |
| ------------- | -------- | ---- | --------------------------------------------------- |
| `workspaceId` | string   | âŒ   | å·¥ä½œç©ºé—´IDï¼ˆä¸ä¼ åˆ™æŸ¥è¯¢æœ‰æƒé™çš„æ‰€æœ‰ç©ºé—´ï¼‰            |
| `status`      | string   | âŒ   | æ–‡æ¡£çŠ¶æ€ï¼š`draft`ã€`normal`ã€`archived`             |
| `visibility`  | string   | âŒ   | å¯è§æ€§ï¼š`private`ã€`workspace`ã€`public`            |
| `parentId`    | string   | âŒ   | çˆ¶æ–‡æ¡£IDï¼ˆç”¨äºæŸ¥è¯¢å­æ–‡æ¡£ï¼‰                          |
| `tags`        | string[] | âŒ   | æ ‡ç­¾IDè¿‡æ»¤ï¼ˆtagIdæ•°ç»„ï¼‰ï¼ŒæŸ¥è¯¢åŒ…å«æŒ‡å®šæ ‡ç­¾çš„æ–‡æ¡£     |
| `category`    | string   | âŒ   | åˆ†ç±»è¿‡æ»¤                                            |
| `sortBy`      | string   | âŒ   | æ’åºå­—æ®µï¼š`updatedAt`ï¼ˆé»˜è®¤ï¼‰ã€`createdAt`ã€`title` |
| `sortOrder`   | string   | âŒ   | æ’åºé¡ºåºï¼š`DESC`ï¼ˆé»˜è®¤ï¼‰ã€`ASC`                     |
| `page`        | number   | âŒ   | é¡µç ï¼Œé»˜è®¤ 1                                        |
| `pageSize`    | number   | âŒ   | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 20                                   |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "items": [
      {
        "docId": "doc_1705123456789_xyz456",
        "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡æ¡£",
        "icon": "ğŸ“„",
        "status": "draft",
        "visibility": "workspace",
        "updatedAt": "2024-01-15T10:30:00.000Z"
      }
    ],
    "total": 1,
    "page": 1,
    "pageSize": 20
  }
}
```

**çŠ¶æ€ç ï¼š**

- `200 OK` - è·å–æˆåŠŸ

## æœç´¢æ–‡æ¡£

**æ¥å£ï¼š** `GET /api/v1/documents/search`

**è¯´æ˜ï¼š** æœç´¢æ–‡æ¡£ï¼Œæ”¯æŒå…¨æ–‡æœç´¢

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**æŸ¥è¯¢å‚æ•°ï¼š**

| å‚æ•°          | ç±»å‹     | å¿…å¡« | è¯´æ˜                                            |
| ------------- | -------- | ---- | ----------------------------------------------- |
| `query`       | string   | âœ…   | æœç´¢å…³é”®è¯                                      |
| `workspaceId` | string   | âŒ   | å·¥ä½œç©ºé—´ID                                      |
| `status`      | string   | âŒ   | æ–‡æ¡£çŠ¶æ€ï¼š`draft`ã€`normal`ã€`archived`         |
| `tags`        | string[] | âŒ   | æ ‡ç­¾IDè¿‡æ»¤ï¼ˆtagIdæ•°ç»„ï¼‰ï¼Œæœç´¢åŒ…å«æŒ‡å®šæ ‡ç­¾çš„æ–‡æ¡£ |
| `page`        | number   | âŒ   | é¡µç ï¼Œé»˜è®¤ 1                                    |
| `pageSize`    | number   | âŒ   | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 20                               |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "items": [
      {
        "docId": "doc_1705123456789_xyz456",
        "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡æ¡£",
        "icon": "ğŸ“„",
        "status": "draft",
        "updatedAt": "2024-01-15T10:30:00.000Z"
      }
    ],
    "total": 1,
    "page": 1,
    "pageSize": 20
  }
}
```

**æœç´¢è¯´æ˜ï¼š**

- ä½¿ç”¨ PostgreSQL çš„ `tsvector` è¿›è¡Œå…¨æ–‡æœç´¢
- æœç´¢æ–‡æ¡£æ ‡é¢˜å’Œå†…å®¹
- æ”¯æŒä¸­æ–‡æœç´¢

**çŠ¶æ€ç ï¼š**

- `200 OK` - æœç´¢æˆåŠŸ

## è·å–æ–‡æ¡£è¯¦æƒ…

**æ¥å£ï¼š** `GET /api/v1/documents/:docId`

**è¯´æ˜ï¼š** è·å–æ–‡æ¡£çš„è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°    | ç±»å‹   | è¯´æ˜   |
| ------- | ------ | ------ |
| `docId` | string | æ–‡æ¡£ID |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "workspaceId": "ws_1705123456789_abc123",
    "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡æ¡£",
    "icon": "ğŸ“„",
    "cover": "https://example.com/cover.jpg",
    "rootBlockId": "b_1705123456789_root789",
    "head": 5,
    "publishedHead": 3,
    "status": "normal",
    "visibility": "workspace",
    "tags": ["tag_1234567890_abc123", "tag_1234567890_def456"],
    "category": "æŠ€æœ¯æ–‡æ¡£",
    "viewCount": 10,
    "favoriteCount": 2,
    "createdAt": "2024-01-15T10:30:00.000Z",
    "updatedAt": "2024-01-15T12:00:00.000Z"
  }
}
```

**çŠ¶æ€ç ï¼š**

- `200 OK` - è·å–æˆåŠŸ
- `404 Not Found` - æ–‡æ¡£ä¸å­˜åœ¨
- `403 Forbidden` - æ²¡æœ‰æƒé™è®¿é—®

## è·å–æ–‡æ¡£å†…å®¹

**æ¥å£ï¼š** `GET /api/v1/documents/:docId/content`

**è¯´æ˜ï¼š** è·å–æ–‡æ¡£çš„å†…å®¹æ ‘ï¼ˆæ¸²æŸ“æ ‘ï¼‰ï¼Œæ”¯æŒåˆ†é¡µåŠ è½½ï¼Œé€‚ç”¨äºè¶…å¤§å‹æ–‡æ¡£

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°    | ç±»å‹   | è¯´æ˜   |
| ------- | ------ | ------ |
| `docId` | string | æ–‡æ¡£ID |

**æŸ¥è¯¢å‚æ•°ï¼š**

| å‚æ•°           | ç±»å‹   | å¿…å¡« | è¯´æ˜                                                                          |
| -------------- | ------ | ---- | ----------------------------------------------------------------------------- |
| `version`      | number | âŒ   | æ–‡æ¡£ç‰ˆæœ¬å·ï¼ˆä¸ä¼ åˆ™ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ `head`ï¼‰                                       |
| `maxDepth`     | number | âŒ   | æœ€å¤§å±‚çº§æ·±åº¦ï¼ˆä»æ ¹å—å¼€å§‹è®¡ç®—ï¼Œ0=åªè¿”å›æ ¹å—ï¼Œ1=æ ¹å—+ç¬¬ä¸€å±‚ï¼Œé»˜è®¤è¿”å›æ‰€æœ‰å±‚çº§ï¼‰ |
| `startBlockId` | string | âŒ   | èµ·å§‹å—IDï¼ˆç”¨äºåˆ†é¡µï¼Œè¿”å›è¯¥å—åŠå…¶åç»­å…„å¼Ÿå—ï¼‰                                  |
| `limit`        | number | âŒ   | æ¯é¡µè¿”å›çš„æœ€å¤§å—æ•°é‡ï¼ˆé»˜è®¤1000ï¼Œæœ€å¤§10000ï¼‰                                   |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "docVer": 5,
    "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡æ¡£",
    "tree": {
      "blockId": "b_1705123456789_root789",
      "type": "root",
      "payload": {
        "type": "root",
        "children": []
      },
      "parentId": "",
      "sortKey": "0",
      "indent": 0,
      "collapsed": false,
      "children": [
        {
          "blockId": "b_1705123456790_block001",
          "type": "paragraph",
          "payload": {
            "text": "è¿™æ˜¯ç¬¬ä¸€æ®µå†…å®¹"
          },
          "parentId": "b_1705123456789_root789",
          "sortKey": "1000000",
          "indent": 0,
          "collapsed": false,
          "children": []
        }
      ]
    },
    "pagination": {
      "totalBlocks": 1500,
      "returnedBlocks": 1000,
      "hasMore": true,
      "nextStartBlockId": "b_1705123456800_block1000"
    }
  }
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ                          | ç±»å‹    | è¯´æ˜                                        |
| ----------------------------- | ------- | ------------------------------------------- |
| `tree`                        | object  | æ–‡æ¡£å†…å®¹æ ‘ï¼ˆæ ¹å—åŠå…¶å­å—ï¼‰                  |
| `pagination.totalBlocks`      | number  | æ–‡æ¡£ä¸­çš„æ€»å—æ•°                              |
| `pagination.returnedBlocks`   | number  | æœ¬æ¬¡è¿”å›çš„å—æ•°é‡                            |
| `pagination.hasMore`          | boolean | æ˜¯å¦è¿˜æœ‰æ›´å¤šå—æœªè¿”å›                        |
| `pagination.nextStartBlockId` | string  | ä¸‹æ¬¡è¯·æ±‚çš„èµ·å§‹å—IDï¼ˆå½“ hasMore ä¸º true æ—¶ï¼‰ |

**åˆ†é¡µä½¿ç”¨è¯´æ˜ï¼š**

- **æŒ‰éœ€åŠ è½½**ï¼šå¯¹äºè¶…å¤§å‹æ–‡æ¡£ï¼Œå»ºè®®ä½¿ç”¨ `maxDepth` å’Œ `limit` å‚æ•°æ§åˆ¶è¿”å›çš„æ•°æ®é‡
- **å±‚çº§åŠ è½½**ï¼šä½¿ç”¨ `maxDepth=0` åªè·å–æ ¹å—ï¼Œç„¶åæŒ‰éœ€åŠ è½½å­å—
- **åˆ†é¡µåŠ è½½**ï¼šå½“ `hasMore=true` æ—¶ï¼Œä½¿ç”¨ `nextStartBlockId` ä½œä¸º `startBlockId` å‚æ•°ç»§ç»­è·å–åç»­å†…å®¹
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé»˜è®¤ `limit=1000`ï¼Œå¯æ ¹æ®å‰ç«¯æ¸²æŸ“èƒ½åŠ›è°ƒæ•´ï¼ˆå»ºè®®ä¸è¶…è¿‡5000ï¼‰

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```typescript
// 1. é¦–æ¬¡åŠ è½½ï¼šåªåŠ è½½å‰2å±‚ï¼Œæœ€å¤š100ä¸ªå—
GET /api/v1/documents/doc_123/content?maxDepth=1&limit=100

// 2. ç»§ç»­åŠ è½½ï¼šä»æŒ‡å®šå—å¼€å§‹åŠ è½½åç»­å†…å®¹
GET /api/v1/documents/doc_123/content?startBlockId=b_xxx&limit=100

// 3. åŠ è½½å®Œæ•´æ–‡æ¡£ï¼ˆä¸æ¨èç”¨äºè¶…å¤§å‹æ–‡æ¡£ï¼‰
GET /api/v1/documents/doc_123/content
```

**è¯´æ˜ï¼š**

- `tree` åŒ…å«æ ¹å—åŠå…¶å­å—çš„æ ‘å½¢ç»“æ„
- å¦‚æœä¸æŒ‡å®š `version`ï¼Œè¿”å›æœ€æ–°ç‰ˆæœ¬ï¼ˆ`head`ï¼‰çš„å†…å®¹
- å¦‚æœæŒ‡å®š `version`ï¼Œè¿”å›è¯¥ç‰ˆæœ¬çš„å†…å®¹ï¼ˆåŸºäºæ—¶é—´ç‚¹è®¡ç®—ï¼‰
- **åˆ†é¡µåŠŸèƒ½**ï¼šç³»ç»Ÿé’ˆå¯¹è¶…å¤§å‹æ–‡æ¡£ä¼˜åŒ–ï¼Œæ”¯æŒæŒ‰å±‚çº§å’Œæ•°é‡åˆ†é¡µï¼Œé¿å…ä¸€æ¬¡æ€§è¿”å›è¿‡å¤šæ•°æ®

**çŠ¶æ€ç ï¼š**

- `200 OK` - è·å–æˆåŠŸ
- `404 Not Found` - æ–‡æ¡£æˆ–ç‰ˆæœ¬ä¸å­˜åœ¨
- `403 Forbidden` - æ²¡æœ‰æƒé™è®¿é—®

## æ›´æ–°æ–‡æ¡£å…ƒæ•°æ®

**æ¥å£ï¼š** `PATCH /api/v1/documents/:docId`

**è¯´æ˜ï¼š** æ›´æ–°æ–‡æ¡£çš„æ ‡é¢˜ã€å›¾æ ‡ã€æ ‡ç­¾ç­‰å…ƒæ•°æ®ã€‚æ›´æ–°æ ‡ç­¾æ—¶ä¼šè‡ªåŠ¨æ ¡éªŒæ ‡ç­¾IDå¹¶æ›´æ–°ä½¿ç”¨ç»Ÿè®¡ã€‚

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
Content-Type: application/json
```

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°    | ç±»å‹   | è¯´æ˜   |
| ------- | ------ | ------ |
| `docId` | string | æ–‡æ¡£ID |

**è¯·æ±‚ä½“ï¼š**

```json
{
  "title": "æ›´æ–°åçš„æ ‡é¢˜",
  "icon": "ğŸ“",
  "tags": ["tag_1234567890_abc123", "tag_1234567890_def456"],
  "visibility": "public"
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ         | ç±»å‹     | å¿…å¡« | è¯´æ˜                                                              |
| ------------ | -------- | ---- | ----------------------------------------------------------------- |
| `title`      | string   | âŒ   | æ–‡æ¡£æ ‡é¢˜ï¼Œ1-255ä¸ªå­—ç¬¦                                             |
| `icon`       | string   | âŒ   | æ–‡æ¡£å›¾æ ‡ï¼ˆemojiï¼‰ï¼Œæœ€å¤š10ä¸ªå­—ç¬¦                                   |
| `cover`      | string   | âŒ   | æ–‡æ¡£å°é¢URLï¼Œæœ€å¤š500ä¸ªå­—ç¬¦                                        |
| `visibility` | string   | âŒ   | å¯è§æ€§ï¼š`private`ã€`workspace`ã€`public`                          |
| `tags`       | string[] | âŒ   | æ ‡ç­¾IDåˆ—è¡¨ï¼ˆtagIdæ•°ç»„ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¡éªŒæ ‡ç­¾æ˜¯å¦å­˜åœ¨å¹¶æ›´æ–°ä½¿ç”¨ç»Ÿè®¡ |
| `category`   | string   | âŒ   | åˆ†ç±»ï¼Œæœ€å¤š50ä¸ªå­—ç¬¦                                                |
| `status`     | string   | âŒ   | æ–‡æ¡£çŠ¶æ€ï¼š`draft`ã€`normal`ã€`archived`                           |

**æƒé™è¦æ±‚ï¼š** ownerã€admin æˆ– editor

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "title": "æ›´æ–°åçš„æ ‡é¢˜",
    "icon": "ğŸ“",
    ...
  }
}
```

**çŠ¶æ€ç ï¼š**

- `200 OK` - æ›´æ–°æˆåŠŸ
- `404 Not Found` - æ–‡æ¡£ä¸å­˜åœ¨
- `403 Forbidden` - æ²¡æœ‰æƒé™

## å‘å¸ƒæ–‡æ¡£

**æ¥å£ï¼š** `POST /api/v1/documents/:docId/publish`

**è¯´æ˜ï¼š** å‘å¸ƒæ–‡æ¡£ï¼Œå°† `publishedHead` è®¾ç½®ä¸ºå½“å‰ `head`

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°    | ç±»å‹   | è¯´æ˜   |
| ------- | ------ | ------ |
| `docId` | string | æ–‡æ¡£ID |

**æƒé™è¦æ±‚ï¼š** ownerã€admin æˆ– editor

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "publishedHead": 5,
    "head": 5,
    ...
  }
}
```

**è¯´æ˜ï¼š**

- å‘å¸ƒåï¼Œ`publishedHead` æŒ‡å‘å½“å‰ `head`
- å·²å‘å¸ƒçš„ç‰ˆæœ¬å†…å®¹ä¸ä¼šå› åç»­ç¼–è¾‘è€Œæ”¹å˜
- å¯ä»¥é€šè¿‡ `GET /documents/:docId/content?version=<publishedHead>` è·å–å·²å‘å¸ƒç‰ˆæœ¬

**çŠ¶æ€ç ï¼š**

- `201 Created` - å‘å¸ƒæˆåŠŸ
- `404 Not Found` - æ–‡æ¡£ä¸å­˜åœ¨
- `403 Forbidden` - æ²¡æœ‰æƒé™

## ç§»åŠ¨æ–‡æ¡£

**æ¥å£ï¼š** `POST /api/v1/documents/:docId/move`

**è¯´æ˜ï¼š** ç§»åŠ¨æ–‡æ¡£åˆ°æ–°çš„ä½ç½®ï¼ˆæ”¹å˜çˆ¶æ–‡æ¡£æˆ–æ’åºï¼‰

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
Content-Type: application/json
```

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°    | ç±»å‹   | è¯´æ˜   |
| ------- | ------ | ------ |
| `docId` | string | æ–‡æ¡£ID |

**è¯·æ±‚ä½“ï¼š**

```json
{
  "parentId": "doc_parent_123",
  "sortOrder": 1
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ        | ç±»å‹   | å¿…å¡« | è¯´æ˜                               |
| ----------- | ------ | ---- | ---------------------------------- |
| `parentId`  | string | âŒ   | æ–°çš„çˆ¶æ–‡æ¡£IDï¼ˆä¸ä¼ åˆ™ç§»åŠ¨åˆ°æ ¹ç›®å½•ï¼‰ |
| `sortOrder` | number | âŒ   | æ–°çš„æ’åºé¡ºåº                       |

**æƒé™è¦æ±‚ï¼š** ownerã€admin æˆ– editor

**é™åˆ¶ï¼š**

- ä¸èƒ½ç§»åŠ¨åˆ°è‡ªèº«æˆ–å½¢æˆå¾ªç¯å¼•ç”¨

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "parentId": "doc_parent_123",
    "sortOrder": 1,
    ...
  }
}
```

**çŠ¶æ€ç ï¼š**

- `200 OK` - ç§»åŠ¨æˆåŠŸ
- `404 Not Found` - æ–‡æ¡£ä¸å­˜åœ¨
- `403 Forbidden` - æ²¡æœ‰æƒé™
- `400 Bad Request` - ç§»åŠ¨æ“ä½œæ— æ•ˆï¼ˆå¦‚å¾ªç¯å¼•ç”¨ï¼‰

## åˆ é™¤æ–‡æ¡£

**æ¥å£ï¼š** `DELETE /api/v1/documents/:docId`

**è¯´æ˜ï¼š** åˆ é™¤æ–‡æ¡£ï¼ˆè½¯åˆ é™¤ï¼‰

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•°    | ç±»å‹   | è¯´æ˜   |
| ------- | ------ | ------ |
| `docId` | string | æ–‡æ¡£ID |

**æƒé™è¦æ±‚ï¼š** owner æˆ– admin

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "message": "æ–‡æ¡£å·²åˆ é™¤"
  }
}
```

**è¯´æ˜ï¼š**

- åˆ é™¤æ˜¯è½¯åˆ é™¤ï¼Œæ–‡æ¡£ä¸ä¼šè¢«ç‰©ç†åˆ é™¤
- åˆ é™¤æ–‡æ¡£ä¼šçº§è”åˆ é™¤å…¶æ‰€æœ‰å­æ–‡æ¡£

**çŠ¶æ€ç ï¼š**

- `200 OK` - åˆ é™¤æˆåŠŸ
- `404 Not Found` - æ–‡æ¡£ä¸å­˜åœ¨
- `403 Forbidden` - æ²¡æœ‰æƒé™

## ç‰ˆæœ¬æ§åˆ¶ç›¸å…³æ¥å£

### è·å–ä¿®è®¢å†å²

**æ¥å£ï¼š** `GET /api/v1/documents/:docId/revisions`

**è¯´æ˜ï¼š** è·å–æ–‡æ¡£çš„ç‰ˆæœ¬ä¿®è®¢å†å²

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**æŸ¥è¯¢å‚æ•°ï¼š**

| å‚æ•°       | ç±»å‹   | å¿…å¡« | è¯´æ˜              |
| ---------- | ------ | ---- | ----------------- |
| `page`     | number | âŒ   | é¡µç ï¼Œé»˜è®¤ 1      |
| `pageSize` | number | âŒ   | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 20 |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "items": [
      {
        "revisionId": "doc_123@5",
        "docVer": 5,
        "message": "Document updated",
        "createdAt": "2024-01-15T12:00:00.000Z",
        "createdBy": "u_1705123456789_abc123"
      }
    ],
    "total": 5,
    "page": 1,
    "pageSize": 20
  }
}
```

### ç‰ˆæœ¬å¯¹æ¯” <Badge type="danger" text="BUG" />

**æ¥å£ï¼š** `GET /api/v1/documents/:docId/diff`

**è¯´æ˜ï¼š** å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**æŸ¥è¯¢å‚æ•°ï¼š**

| å‚æ•°      | ç±»å‹   | å¿…å¡« | è¯´æ˜       |
| --------- | ------ | ---- | ---------- |
| `fromVer` | number | âœ…   | èµ·å§‹ç‰ˆæœ¬å· |
| `toVer`   | number | âœ…   | ç›®æ ‡ç‰ˆæœ¬å· |

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "fromVer": 3,
    "toVer": 5,
    "fromContent": { ... },
    "toContent": { ... }
  }
}
```

### å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ <Badge type="danger" text="BUG" />

**æ¥å£ï¼š** `POST /api/v1/documents/:docId/revert`

**è¯´æ˜ï¼š** å°†æ–‡æ¡£å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**

```json
{
  "version": 3
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ      | ç±»å‹   | å¿…å¡« | è¯´æ˜             |
| --------- | ------ | ---- | ---------------- |
| `version` | number | âœ…   | è¦å›æ»šåˆ°çš„ç‰ˆæœ¬å· |

**æƒé™è¦æ±‚ï¼š** ownerã€admin æˆ– editor

**è¯´æ˜ï¼š**

- å›æ»šä¼šåˆ›å»ºæ–°ç‰ˆæœ¬ï¼ˆ`head` é€’å¢ï¼‰ï¼Œä¸ä¼šè¦†ç›–å†å²ç‰ˆæœ¬
- å›æ»šåå¯ä»¥å†æ¬¡å›æ»šåˆ°æ›´æ—©çš„ç‰ˆæœ¬

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "head": 6,
    ...
  }
}
```

### åˆ›å»ºå¿«ç…§ <Badge type="danger" text="BUG" />

**æ¥å£ï¼š** `POST /api/v1/documents/:docId/snapshots`

**è¯´æ˜ï¼š** åˆ›å»ºæ–‡æ¡£å¿«ç…§ï¼Œä¿å­˜å½“å‰ç‰ˆæœ¬çš„å®Œæ•´å—ç‰ˆæœ¬æ˜ å°„

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**æƒé™è¦æ±‚ï¼š** ownerã€admin æˆ– editor

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "snapshotId": "doc_123@snap@5",
    "docId": "doc_1705123456789_xyz456",
    "docVer": 5,
    "blockVersionMap": {
      "b_root": 1,
      "b_block_001": 3,
      "b_block_002": 2
    },
    "createdAt": "2024-01-15T12:00:00.000Z"
  }
}
```

**è¯´æ˜ï¼š**

- å¿«ç…§æ˜¯å¹‚ç­‰çš„ï¼šå¦‚æœå·²å­˜åœ¨ç›¸åŒ `docVer` çš„å¿«ç…§ï¼Œç›´æ¥è¿”å›
- å¿«ç…§ä¿å­˜çš„æ˜¯å½“å‰ `head` çš„å®Œæ•´çŠ¶æ€ï¼Œå¯ç”¨äºå¿«é€Ÿæ¢å¤

### æ‰‹åŠ¨è§¦å‘åˆ›å»ºç‰ˆæœ¬

**æ¥å£ï¼š** `POST /api/v1/documents/:docId/commit`

**è¯´æ˜ï¼š** æ‰‹åŠ¨è§¦å‘åˆ›å»ºæ–‡æ¡£ç‰ˆæœ¬ï¼Œå°†æ‰€æœ‰å¾…åˆ›å»ºçš„æ“ä½œåˆå¹¶ä¸ºä¸€ä¸ªç‰ˆæœ¬

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**

```json
{
  "message": "å®Œæˆç¼–è¾‘"
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ      | ç±»å‹   | å¿…å¡« | è¯´æ˜                    |
| --------- | ------ | ---- | ----------------------- |
| `message` | string | âŒ   | ç‰ˆæœ¬æ¶ˆæ¯ï¼Œæœ€å¤š500ä¸ªå­—ç¬¦ |

**æƒé™è¦æ±‚ï¼š** ownerã€admin æˆ– editor

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "version": 5,
    "pendingOperations": 3,
    "message": "å®Œæˆç¼–è¾‘"
  }
}
```

**è¯´æ˜ï¼š**

- å¦‚æœæ–‡æ¡£æ²¡æœ‰å¾…åˆ›å»ºçš„ç‰ˆæœ¬ï¼ˆ`pendingCount = 0`ï¼‰ï¼Œä¼šè¿”å› `400 Bad Request`
- åˆ›å»ºçš„ç‰ˆæœ¬ä¼šåŒ…å«æ‰€æœ‰å¾…å¤„ç†æ“ä½œçš„æ•°é‡ä¿¡æ¯
- åˆ›å»ºç‰ˆæœ¬åï¼Œå¾…åˆ›å»ºç‰ˆæœ¬è®¡æ•°ä¼šè¢«æ¸…é™¤

**çŠ¶æ€ç ï¼š**

- `200 OK` - ç‰ˆæœ¬åˆ›å»ºæˆåŠŸ
- `400 Bad Request` - æ²¡æœ‰å¾…åˆ›å»ºçš„ç‰ˆæœ¬
- `404 Not Found` - æ–‡æ¡£ä¸å­˜åœ¨
- `403 Forbidden` - æ²¡æœ‰æƒé™

### è·å–å¾…åˆ›å»ºç‰ˆæœ¬æ•°é‡

**æ¥å£ï¼š** `GET /api/v1/documents/:docId/pending-versions`

**è¯´æ˜ï¼š** æŸ¥è¯¢æ–‡æ¡£å½“å‰æœ‰å¤šå°‘å¾…åˆ›å»ºçš„ç‰ˆæœ¬

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer <your-access-token>
```

**å“åº”ç¤ºä¾‹ï¼š**

```json
{
  "success": true,
  "data": {
    "docId": "doc_1705123456789_xyz456",
    "pendingCount": 3,
    "hasPending": true
  }
}
```

**å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ           | ç±»å‹    | è¯´æ˜               |
| -------------- | ------- | ------------------ |
| `pendingCount` | number  | å¾…åˆ›å»ºç‰ˆæœ¬çš„æ•°é‡   |
| `hasPending`   | boolean | æ˜¯å¦æœ‰å¾…åˆ›å»ºçš„ç‰ˆæœ¬ |

**çŠ¶æ€ç ï¼š**

- `200 OK` - è·å–æˆåŠŸ
- `404 Not Found` - æ–‡æ¡£ä¸å­˜åœ¨
- `403 Forbidden` - æ²¡æœ‰æƒé™è®¿é—®
